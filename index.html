<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Marauder</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Matrix/CRT Aesthetic Effects */
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #050505;
            color: #00ff41;
            overflow: hidden;
        }

        /* Scanline effect */
        .scan-line {
            width: 100%;
            height: 100px;
            z-index: 20;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(0, 255, 65, 0.04) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 10s linear infinite;
            pointer-events: none;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100px; }
        }

        /* CRT flicker */
        .crt-flicker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            z-index: 10;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.02; }
            50% { opacity: 0.05; }
            100% { opacity: 0.02; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #001100; 
        }
        ::-webkit-scrollbar-thumb {
            background: #004400; 
            border: 1px solid #00ff41;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #006600; 
        }

        .terminal-text {
            text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
            line-height: 1.2;
        }
        
        /* Matrix Button Styles */
        .btn-matrix {
            background: rgba(0, 50, 0, 0.3);
            border: 1px solid #005500;
            color: #00ff41;
            transition: all 0.2s;
            text-transform: uppercase;
            font-size: 0.7rem;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
        }
        .btn-matrix:hover:not(:disabled) {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 10px #00ff41;
        }
        .btn-matrix:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #002200;
        }
        
        .btn-danger {
            border-color: #aa0000;
            color: #ff3333;
            background: rgba(50, 0, 0, 0.2);
        }
        .btn-danger:hover:not(:disabled) {
            background: #ff0000;
            color: #000;
            box-shadow: 0 0 10px #ff0000;
        }

        .tab-active {
            background: #00ff41;
            color: black;
            font-weight: bold;
        }
        
        .section-header {
            font-size: 0.65rem;
            color: #007700;
            border-bottom: 1px solid #004400;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            font-weight: bold;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 16, className }) => {
            if (!window.lucide || !window.lucide.icons) return null;
            const LucideIcon = window.lucide.icons[name];
            if (!LucideIcon) return null;

            if (typeof window.lucide.createElement === 'function') {
                try {
                    const svgElement = window.lucide.createElement(LucideIcon);
                    svgElement.setAttribute('width', size);
                    svgElement.setAttribute('height', size);
                    const baseClass = "lucide lucide-" + name.toLowerCase(); 
                    svgElement.setAttribute('class', `${baseClass} ${className || ''}`.trim());
                    svgElement.setAttribute('stroke', 'currentColor');
                    svgElement.setAttribute('stroke-width', '2');
                    svgElement.setAttribute('fill', 'none');
                    return <span style={{ display: 'inline-flex', alignItems: 'center' }} dangerouslySetInnerHTML={{ __html: svgElement.outerHTML }} />;
                } catch (e) { return null; }
            }
            return null;
        };

        function App() {
            // Serial State
            const [port, setPort] = useState(null);
            const [isConnected, setIsConnected] = useState(false);
            const [reader, setReader] = useState(null);
            const [writer, setWriter] = useState(null);
            const [baudRate, setBaudRate] = useState(115200);

            // App State
            const [logs, setLogs] = useState([]);
            const [activeTab, setActiveTab] = useState('wifi'); // wifi, ble, attack, sniffers, system
            const [manualTarget, setManualTarget] = useState("");
            const [manualStationTarget, setManualStationTarget] = useState("");
            const [logoError, setLogoError] = useState(false);
            
            const terminalEndRef = useRef(null);
            const logsRef = useRef(logs); 

            useEffect(() => { logsRef.current = logs; }, [logs]);
            
            useEffect(() => {
                if (terminalEndRef.current) {
                    terminalEndRef.current.scrollIntoView({ behavior: "smooth" });
                }
            }, [logs]);

            // --- Serial Connection Logic ---
            const connectSerial = async () => {
                if (!navigator.serial) {
                    alert("Web Serial API not supported. Use Chrome/Edge.");
                    return;
                }
                try {
                    const selectedPort = await navigator.serial.requestPort();
                    await selectedPort.open({ baudRate: parseInt(baudRate) });
                    
                    const textEncoder = new TextEncoderStream();
                    const writableStreamClosed = textEncoder.readable.pipeTo(selectedPort.writable);
                    const writer = textEncoder.writable.getWriter();
                    
                    const textDecoder = new TextDecoderStream();
                    const readableStreamClosed = selectedPort.readable.pipeTo(textDecoder.writable);
                    const reader = textDecoder.readable.getReader();

                    setPort(selectedPort);
                    setWriter(writer);
                    setReader(reader);
                    setIsConnected(true);
                    addLog("--- SYSTEM ONLINE: GHOST ESP CONNECTED ---");
                    readLoop(reader);
                } catch (error) {
                    addLog(`--- CONNECTION FAILED: ${error.message} ---`);
                }
            };

            const disconnectSerial = async () => {
                try {
                    if (reader) await reader.cancel();
                    if (writer) await writer.close();
                    if (port) await port.close();
                } catch (e) {
                    console.error(e);
                } finally {
                    setReader(null);
                    setWriter(null);
                    setPort(null);
                    setIsConnected(false);
                    addLog("--- SYSTEM OFFLINE ---");
                }
            };

            const readLoop = async (reader) => {
                let buffer = "";
                try {
                    while (true) {
                        const { value, done } = await reader.read();
                        if (done) break;
                        buffer += value;
                        const lines = buffer.split('\n');
                        buffer = lines.pop(); 
                        for (const line of lines) {
                            const cleaned = line.replace(/\r/g, '');
                            if (cleaned.trim() !== '') {
                                addLog(cleaned);
                            }
                        }
                    }
                } catch (error) {
                    console.error(error);
                } finally {
                    if (reader) reader.releaseLock();
                }
            };

            const sendCommand = async (cmd) => {
                if (!writer) {
                    addLog("--- ERROR: NOT CONNECTED ---");
                    return;
                }
                try {
                    await writer.write(cmd + "\r\n");
                    addLog(`> ${cmd}`);
                } catch (e) {
                    addLog(`--- TX ERROR: ${e.message} ---`);
                }
            };

            const addLog = (text) => {
                setLogs(prev => {
                    const newLogs = [...prev, text];
                    return newLogs.length > 1000 ? newLogs.slice(-1000) : newLogs;
                });
            };

            // --- Control Handlers ---
            const handleSelect = () => {
                if (!manualTarget) {
                    addLog("--- ERROR: ENTER INDEX ID FIRST ---");
                    return;
                }
                sendCommand(`select -a ${manualTarget}`);
            };

            const handleStationSelect = () => {
                if (!manualStationTarget) {
                    addLog("--- ERROR: ENTER STATION INDEX ID FIRST ---");
                    return;
                }
                sendCommand(`select -c ${manualStationTarget}`);
            };

            // --- Render Logic ---
            const renderControls = () => {
                switch(activeTab) {
                    case 'wifi':
                        return (
                            <div className="space-y-4">
                                <div>
                                    <div className="section-header">SCANNERS</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => sendCommand('scanap')} disabled={!isConnected} className="btn-matrix">
                                            <Icon name="Wifi" /> SCAN APs
                                        </button>
                                        <button onClick={() => sendCommand('scansta')} disabled={!isConnected} className="btn-matrix">
                                            <Icon name="Smartphone" /> SCAN STAs
                                        </button>
                                        <button onClick={() => sendCommand('scanall')} disabled={!isConnected} className="btn-matrix">
                                            <Icon name="Globe" /> SCAN ALL
                                        </button>
                                        <button onClick={() => sendCommand('stopscan')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            <Icon name="Square" /> STOP SCAN
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div className="section-header">TARGET SELECTION</div>
                                    <div className="space-y-2">
                                        {/* AP Selection */}
                                        <div className="flex gap-2 items-end">
                                            <input 
                                                type="text" 
                                                value={manualTarget}
                                                onChange={(e) => setManualTarget(e.target.value)}
                                                placeholder="AP Index (e.g. 0,2)"
                                                className="flex-1 bg-black border border-green-700 text-green-500 px-2 py-1 text-sm focus:outline-none focus:border-green-400 font-mono"
                                            />
                                            <button onClick={handleSelect} disabled={!isConnected} className="btn-matrix w-auto px-2">
                                                SEL AP (-a)
                                            </button>
                                        </div>

                                        {/* Station Selection */}
                                        <div className="flex gap-2 items-end">
                                            <input 
                                                type="text" 
                                                value={manualStationTarget}
                                                onChange={(e) => setManualStationTarget(e.target.value)}
                                                placeholder="Station Index (e.g. 0,1)"
                                                className="flex-1 bg-black border border-green-700 text-green-500 px-2 py-1 text-sm focus:outline-none focus:border-green-400 font-mono"
                                            />
                                            <button onClick={handleStationSelect} disabled={!isConnected} className="btn-matrix w-auto px-2">
                                                SEL STA (-c)
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div className="section-header">LISTS</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => sendCommand('list -a')} disabled={!isConnected} className="btn-matrix">
                                            <Icon name="List" /> LIST APs
                                        </button>
                                        <button onClick={() => sendCommand('list -c')} disabled={!isConnected} className="btn-matrix">
                                            <Icon name="Users" /> LIST CLIENTS
                                        </button>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'ble':
                        return (
                            <div className="space-y-2">
                                <div className="text-xs text-green-700 font-bold mb-1 border-b border-green-900">RECON</div>
                                <div className="grid grid-cols-2 gap-2">
                                    <button onClick={() => sendCommand('sniffbt')} disabled={!isConnected} className="btn-matrix">
                                        <Icon name="Bluetooth" /> SNIFF BT
                                    </button>
                                    <button onClick={() => sendCommand('sniffskim')} disabled={!isConnected} className="btn-matrix">
                                        <Icon name="CreditCard" /> SNIFF SKIM
                                    </button>
                                    <button onClick={() => sendCommand('btwardrive')} disabled={!isConnected} className="btn-matrix">
                                        <Icon name="MapPin" /> WARDRIVE
                                    </button>
                                </div>
                                <div className="text-xs text-red-700 font-bold mb-1 border-b border-red-900 mt-2">OFFENSIVE</div>
                                <div className="grid grid-cols-2 gap-2">
                                    <button onClick={() => sendCommand('blespam -t all')} disabled={!isConnected} className="btn-matrix btn-danger col-span-2">
                                        SPAM ALL
                                    </button>
                                    <button onClick={() => sendCommand('blespam -t apple')} disabled={!isConnected} className="btn-matrix btn-danger">
                                        APPLE
                                    </button>
                                    <button onClick={() => sendCommand('blespam -t google')} disabled={!isConnected} className="btn-matrix btn-danger">
                                        GOOGLE
                                    </button>
                                    <button onClick={() => sendCommand('blespam -t samsung')} disabled={!isConnected} className="btn-matrix btn-danger">
                                        SAMSUNG
                                    </button>
                                    <button onClick={() => sendCommand('blespam -t windows')} disabled={!isConnected} className="btn-matrix btn-danger">
                                        WINDOWS
                                    </button>
                                    <button onClick={() => sendCommand('stopscan')} disabled={!isConnected} className="btn-matrix col-span-2 border-red-500">
                                        <Icon name="Square" /> STOP BLE
                                    </button>
                                </div>
                            </div>
                        );
                    case 'attack':
                        return (
                            <div className="space-y-3">
                                {/* Beacon Spam Attacks */}
                                <div className="space-y-1">
                                    <div className="section-header text-red-500 border-red-900">BEACON SPAM ATTACKS</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => sendCommand('attack -t beacon -r')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            SPAM RANDOM (-r)
                                        </button>
                                        <button onClick={() => sendCommand('attack -t beacon -a')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            SPAM AP COPY (-a)
                                        </button>
                                    </div>
                                </div>

                                {/* Sleep Attacks */}
                                <div className="space-y-1">
                                    <div className="section-header text-red-500 border-red-900">ASSOC. SLEEP ATTACK</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => sendCommand('attack -t sleep')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            SLEEP (FULL)
                                        </button>
                                        <button onClick={() => sendCommand('attack -t sleep -c')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            SLEEP (TARGETED)
                                        </button>
                                    </div>
                                </div>

                                {/* Other Attacks */}
                                <div className="space-y-1">
                                    <div className="section-header text-red-500 border-red-900">OTHER ATTACKS</div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => sendCommand('attack -t deauth')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            DEAUTH
                                        </button>
                                        <button onClick={() => sendCommand('attack -t probe')} disabled={!isConnected} className="btn-matrix btn-danger">
                                            PROBE FLOOD
                                        </button>
                                        <button onClick={() => sendCommand('attack -t rickroll')} disabled={!isConnected} className="btn-matrix btn-danger col-span-2">
                                            RICKROLL
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="mt-2 pt-2 border-t border-green-900">
                                     <button onClick={() => sendCommand('stopscan')} disabled={!isConnected} className="w-full btn-matrix btn-danger border-red-500 justify-center">
                                        <Icon name="Octagon" /> CEASE ALL ATTACKS (stopscan)
                                    </button>
                                </div>
                            </div>
                        );
                    case 'sniffers':
                         return (
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => sendCommand('sniffpmkid')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Key" /> SNIFF PMKID
                                </button>
                                <button onClick={() => sendCommand('sniffesp')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Cpu" /> SNIFF ESP
                                </button>
                                <button onClick={() => sendCommand('sniffdeauth')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="WifiOff" /> SNIFF DEAUTH
                                </button>
                                <button onClick={() => sendCommand('sniffbeacon')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Radio" /> SNIFF BEACON
                                </button>
                                <button onClick={() => sendCommand('sniffprobe')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Search" /> SNIFF PROBE
                                </button>
                                <button onClick={() => sendCommand('stopscan')} disabled={!isConnected} className="btn-matrix btn-danger">
                                    <Icon name="Square" /> STOP SNIFF
                                </button>
                            </div>
                        );
                    case 'system':
                        return (
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => sendCommand('reboot')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="RefreshCw" /> REBOOT
                                </button>
                                <button onClick={() => sendCommand('help')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="HelpCircle" /> HELP
                                </button>
                                <button onClick={() => sendCommand('info')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Info" /> INFO
                                </button>
                                <button onClick={() => sendCommand('led -p rainbow')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Sun" /> LED RAINBOW
                                </button>
                                <button onClick={() => sendCommand('clearlist -a')} disabled={!isConnected} className="btn-matrix">
                                    <Icon name="Trash" /> CLEAR LISTS
                                </button>
                                 <button onClick={() => sendCommand('stopscan')} disabled={!isConnected} className="btn-matrix btn-danger">
                                    <Icon name="Power" /> EMERG. STOP
                                </button>
                            </div>
                        );
                    default: return null;
                }
            };

            return (
                <div className="h-screen w-full flex flex-col relative bg-black text-green-500 overflow-hidden">
                    <div className="scan-line"></div>
                    <div className="crt-flicker"></div>

                    {/* Header */}
                    <header className="shrink-0 border-b border-green-800 bg-black/80 p-2 flex justify-between items-center z-30">
                        <div className="flex items-center gap-3">
                            {logoError ? (
                                <div className="p-1 bg-green-900/30 border border-green-600 rounded">
                                    <Icon name="Ghost" size={20} />
                                </div>
                            ) : (
                                <img 
                                    src="marauder_skull_patch_04_full_final.png" 
                                    className="w-12 h-12 object-contain drop-shadow-[0_0_5px_rgba(0,255,65,0.5)]"
                                    alt="Marauder Logo"
                                    onError={() => setLogoError(true)}
                                />
                            )}
                            <div>
                                <h1 className="text-lg font-bold tracking-widest text-white leading-none"> Esp32 MARAUDER</h1>
                                <p className="text-[9px] text-green-400 tracking-[0.2em]">COMMAND DECK</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-2">
                            <select 
                                value={baudRate} 
                                onChange={(e) => setBaudRate(e.target.value)}
                                className="bg-black border border-green-800 text-green-600 px-2 py-1 rounded text-xs focus:outline-none"
                                disabled={isConnected}
                            >
                                <option value="115200">115200</option>
                                <option value="9600">9600</option>
                            </select>
                            {!isConnected ? (
                                <button onClick={connectSerial} className="bg-green-700 hover:bg-green-600 text-black font-bold px-3 py-1 rounded text-xs transition-all">
                                    CONNECT
                                </button>
                            ) : (
                                <button onClick={disconnectSerial} className="bg-red-900/20 border border-red-600 text-red-500 px-3 py-1 rounded text-xs transition-all">
                                    DISCONNECT
                                </button>
                            )}
                        </div>
                    </header>

                    {/* Main Body */}
                    <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
                        
                        {/* LEFT: Control Panel */}
                        <div className="w-full md:w-[350px] flex flex-col border-r border-green-900 bg-neutral-900/95 z-20 shrink-0 h-[50%] md:h-full">
                            
                            {/* Tab Navigation */}
                            <div className="flex border-b border-green-900 bg-black overflow-x-auto">
                                {['wifi', 'ble', 'attack', 'sniffers', 'system'].map(tab => (
                                    <button 
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`flex-1 py-2 px-2 text-[10px] md:text-xs uppercase tracking-wider transition-colors border-r border-green-900 last:border-0 whitespace-nowrap ${activeTab === tab ? 'tab-active' : 'text-green-700 hover:text-green-400'}`}
                                    >
                                        {tab}
                                    </button>
                                ))}
                            </div>

                            {/* Controls Area */}
                            <div className="flex-1 overflow-y-auto p-3">
                                {renderControls()}
                            </div>

                            {/* Quick Status */}
                             <div className="p-2 border-t border-green-900 bg-black text-[10px] text-center text-green-800">
                                MARAUDER FW V1.0 | WEB SERIAL
                            </div>
                        </div>

                        {/* RIGHT: Terminal */}
                        <div className="flex-1 flex flex-col bg-black min-h-0 z-10 relative">
                            <div className="bg-green-950/20 p-1 px-3 border-b border-green-900 flex justify-between items-center text-[10px] text-green-600 shrink-0">
                                <span>SERIAL OUTPUT STREAM</span>
                                <button onClick={() => setLogs([])} className="hover:text-white">CLEAR</button>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto p-4 font-mono text-xs md:text-sm terminal-text space-y-1">
                                {logs.length === 0 && <div className="text-green-900 opacity-50 italic">Waiting for serial data...</div>}
                                {logs.map((log, i) => (
                                    <div key={i} className="break-all whitespace-pre-wrap">{log}</div>
                                ))}
                                <div ref={terminalEndRef} />
                            </div>

                            <form 
                                onSubmit={(e) => {
                                    e.preventDefault();
                                    const cmd = e.target.elements.cmd.value;
                                    sendCommand(cmd);
                                    e.target.elements.cmd.value = '';
                                }}
                                className="border-t border-green-800 p-2 flex gap-2 bg-black/90 shrink-0"
                            >
                                <span className="text-green-500 font-bold">{'>'}</span>
                                <input 
                                    name="cmd" 
                                    autoComplete="off"
                                    className="flex-1 bg-transparent border-none outline-none text-green-400 font-mono placeholder-green-900 text-sm"
                                    placeholder="Enter manual command..." 
                                />
                            </form>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>